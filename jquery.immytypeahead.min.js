(function(){var a=[].slice,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};!function(d,e){var f,g,h;return h="immytypeahead",g={choices:[],maxResults:50,filterFn:function(a){return function(b){return b.text.toLowerCase().indexOf(a.toLowerCase())>=0}},formatChoice:function(b,c){var d,e,f,g,h;return e=b.text.toLowerCase().indexOf(c.toLowerCase()),e>=0?(f=b.text.slice(e,e+c.length),h=b.text.split(f),d=h[0],g=2<=h.length?a.call(h,1):[],""+d+"<span class='highlight'>"+f+"</span>"+g.join(f)):b.text}},f=function(){function a(a,c){this.reposition=b(this.reposition,this),this.hide=b(this.hide,this),this.doSelection=b(this.doSelection,this),this.doQuery=b(this.doQuery,this);var f,i;f=this,this.element=d(a),this.element.addClass(h),this.element.attr("autocomplete","off"),this._defaults=g,this._name=h,this.options=d.extend({},g,c),this.choices=this.options.choices,this.queryResultArea=d("<div class='"+h+"_results'></div>"),"function"==typeof(i=this.queryResultArea).scrollLock&&i.scrollLock(),this._val=this.element.val(),this.queryResultArea.on("click","li."+h+"_choice",function(){var a;return a=d(this).data("value"),f._val=a,f.element.val(a),f.element.trigger("change"),f.hideResults(),f.element.focus()}),this.queryResultArea.on("mouseenter","li."+h+"_choice",function(){return f.queryResultArea.find("li."+h+"_choice.active").removeClass("active"),d(this).addClass("active")}),this.element.on("keyup change search",this.doQuery),this.element.on("keydown",this.doSelection),d("body").on("click",this.hide),d(e).on("resize scroll",this.reposition)}return a.prototype.doQuery=function(){var a;return a=this.element.val(),this._val!==a?(this._val=a,""===a?this.hideResults():this.insertFilteredChoiceElements(a)):void 0},a.prototype.doSelection=function(a){if(27===a.which&&this.hideResults(),this.queryResultArea.is(":visible"))switch(a.which){case 9:return this.selectHighlightedChoice();case 13:return a.preventDefault(),this.selectHighlightedChoice();case 38:return a.preventDefault(),this.highlightPreviousChoice(),this.scroll();case 40:return a.preventDefault(),this.highlightNextChoice(),this.scroll()}},a.prototype.hide=function(){return this.queryResultArea.is(":visible")?this.hideResults():void 0},a.prototype.reposition=function(){return this.queryResultArea.is(":visible")?this.positionResultsArea():void 0},a.prototype.insertFilteredChoiceElements=function(a){var b,c,e,f,g;return b=""===a?this.choices:this.choices.filter(this.options.filterFn(a)),g=b.slice(0,this.options.maxResults),c=this.options.formatChoice,f=g.map(function(b){var e;return e=d("<li class='"+h+"_choice'></li>"),e.attr("data-value",b.text),e.html(c(b,a)),e}),0===f.length?this.queryResultArea.empty().detach():(f[0].addClass("active"),e=d("<ul></ul>").append(f),this.queryResultArea.empty().append(e),this.showResults())},a.prototype.scroll=function(){var a,b,c,d,e,f,g;return f=this.queryResultArea.height(),g=this.queryResultArea.scrollTop(),e=g+f,a=this.getHighlightedChoice(),null==a?!0:(c=a.outerHeight(),d=a.position().top+g,b=d+c,g>d&&this.queryResultArea.scrollTop(d),b>e?this.queryResultArea.scrollTop(b-f):void 0)},a.prototype.positionResultsArea=function(){var a,b,c,f,g,h;return b=this.element.offset(),a=this.element.outerHeight(),c=this.element.outerWidth(),g=this.queryResultArea.outerHeight(),f=b.top+a+g,h=d(e).height()+d(e).scrollTop(),this.queryResultArea.outerWidth(c),this.queryResultArea.css({left:b.left}),this.queryResultArea.css(f>h?{top:b.top-g}:{top:b.top+a})},a.prototype.getHighlightedChoice=function(){var a;return a=this.queryResultArea.find("li."+h+"_choice.active"),1===a.length?a:null},a.prototype.highlightNextChoice=function(){var a,b;return a=this.getHighlightedChoice(),null!=a&&(b=a.next("li."+h+"_choice"),1===b.length)?(a.removeClass("active"),b.addClass("active")):void 0},a.prototype.highlightPreviousChoice=function(){var a,b;return a=this.getHighlightedChoice(),null!=a&&(b=a.prev("li."+h+"_choice"),1===b.length)?(a.removeClass("active"),b.addClass("active")):void 0},a.prototype.selectHighlightedChoice=function(){var a,b;return a=this.getHighlightedChoice(),null!=a?(b=a.data("value"),this._val=b,this.element.val(b),this.element.trigger("change"),this.hideResults()):void 0},a.prototype.showResults=function(){return d("body").append(this.queryResultArea),this.scroll(),this.positionResultsArea()},a.prototype.hideResults=function(){return this.queryResultArea.detach()},a.prototype.selectChoiceByValue=function(a){return this.element.val(a),this.element.trigger("change")},a.prototype.publicMethods=["getChoices","setChoices","destroy"],a.prototype.getChoices=function(){return this.choices},a.prototype.setChoices=function(a){return this.choices=a,null!=this.selectedChoice&&this.selectChoiceByValue(this.selectedChoice.value),a},a.prototype.destroy=function(){return this.element.off("keyup change search",this.doQuery),this.element.off("keydown",this.doSelection),d("body").off("click",this.hide),d(e).off("resize scroll",this.reposition),this.element.removeClass(h),this.queryResultArea.remove(),d.removeData(this.element[0],"plugin_"+h)},a}(),d.fn[h]=function(a){var b,e;return b=Array.prototype.slice.call(arguments,1),e=[],this.each(function(){var g,i;if(!d.data(this,"plugin_"+h))return e.push(d.data(this,"plugin_"+h,new f(this,a)));if(null!=a&&"string"==typeof a){if(i=d.data(this,"plugin_"+h),g=a,c.call(i.publicMethods,g)>=0)return e.push(i[g].apply(i,b));throw new Error(""+h+" has no method '"+g+"'")}}),e}}(jQuery,window,document)}).call(this);